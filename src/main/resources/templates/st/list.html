<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:with="requireLogin=true">
<!--datetimepicker bootstrap-->

<head>
    <title>출입로그</title>
    <link rel="stylesheet" type="text/css" media="screen" th:href="@{/css/bootstrap-datetimepicker.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/status/list.css}">
    <script type="text/javascript" src="/js/bootstrap-datetimepicker.js"></script>
    <style>
        .mno {
            background-color: #dccceb !important;
        }
    </style>
</head>

<th:block th:replace="~{layout/adminLTE :: setContent(~{this::content} )}">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">출입로그</h1>
                </div><!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item active">status-list</li>
                    </ol>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>

    <th:block th:fragment="content">

        <form action="/st" method="get" id="searchForm">
            <div class="input-group">
                <input type="hidden" name="page" value="1">
                <span class="container" id="date-span-id"  style="margin:0px; text-align: left;">
                    <div class="table-filter">
                        <div class="table-filter-group">
                            <div class="filter-group">
                                <label>시설번호</label>
                                <input name="keyword" id="filterBuildingNo" th:value="${pageRequestDTO.keyword}" type="text" class="form-control">
                            </div>
                            <div class="filter-group">
                                <label>멤버번호</label>
                                <input name="mno" id="filterMemberNo" th:value="${pageRequestDTO.mno}" type="text" class="form-control">
                            </div>
                            <div id="contactDiv" class="filter-group" th:classappend="${#strings.isEmpty(pageRequestDTO.closeContact)} ? 'd-none' : ''">
                                <label>시간간격(분:초)</label>
                                <input name="closeContact" id="closeContactcloseContact" class="form-control" value="00:00" th:value="${pageRequestDTO.closeContact}"
                                       type="text" placeholder="00:00 (분:초)">
                            </div>
                        </div>
                        <div class="table-filter-group">
                            <div class="filter-group">
                                <label>날짜(from)</label>
                                <input name="from" id="filterDateFrom" type="date" th:value="${pageRequestDTO.from}" class="form-control">
                            </div>
                            <div class="filter-group">
                                <label>날짜(to)</label>
                                <input name="to" id="filterDateTo" type="date" th:value="${pageRequestDTO.to}" class="form-control">
                            </div>
                        </div>
                    </div>

                    <button type="button" class="btn btn-outline-secondary btn-search"><i class="fa fa-search"></i> 검색</button>
                    <button type="button" class="btn btn-outline-secondary btn-clear">초기화</button>
                </span>
            </div>
        </form>

        <!-- TABLE 멤버id, 시설id, 입장로그번호, 퇴장로그번호, 입장시간, 퇴장시간 -->
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">이름(멤버ID)</th>
                <th scope="col">시설(시설ID)</th>
                <th scope="col">입장시간</th>
                <th scope="col">퇴장시간</th>
                <th scope="col">입장체온</th>
                <th scope="col">퇴장체온</th>
            </tr>
            </thead>
            <tbody>

            <tr th:each="accessSet, index : ${result.getDtoList()}">
                <input class="mno" type="hidden" th:value="${accessSet.memberId}"/>
                <td>[[(${pageRequestDTO.page}-1)*10+${index.count}]]</td>
                <td th:text="|${accessSet.memberName}(${accessSet.memberId})|"></td>
                <td th:text="|${accessSet.facilityName}(${accessSet.facilityId})|"></td>
                <td th:text="${#temporals.format(accessSet.timeEnter, 'yyyy-MM-dd HH:mm:ss')}"></td>
                <td th:text="${#temporals.format(accessSet.timeLeave, 'yyyy-MM-dd HH:mm:ss')}"></td>
                <td th:text="|${accessSet.temperatureEnter}|"></td>
                <td th:text="|${accessSet.temperatureLeave}|"></td>

            </tr>

            </tbody>
        </table>

        <ul class="pagination h-100 justify-content-center align-items-center">

            <li class="page-item " th:if="${result.prev}">
                <a class="page-link" th:href="@{/st(page= ${result.start -1},
                    from=${pageRequestDTO.from},
                    to=${pageRequestDTO.to},
                    keyword = ${pageRequestDTO.keyword},
                    mno = ${pageRequestDTO.mno})}" tabindex="-1">Previous</a>
            </li>

            <li th:class=" 'page-item ' + ${result.page == page?'active':''} " th:each="page: ${result.pageList}">
                <a class="page-link" th:href="@{/st(page = ${page} ,
                    from=${pageRequestDTO.from},
                    to=${pageRequestDTO.to},
                    keyword = ${pageRequestDTO.keyword},
                    mno = ${pageRequestDTO.mno})}">
                    [[${page}]]
                </a>
            </li>

            <li class="page-item" th:if="${result.next}">
                <a class="page-link" th:href="@{/st(page= ${result.end + 1} ,
                    from=${pageRequestDTO.from},
                    to=${pageRequestDTO.to},
                    keyword = ${pageRequestDTO.keyword},
                    mno = ${pageRequestDTO.mno})}">Next</a>
            </li>
        </ul>

        <script th:inline="javascript">

            (function() {
                "use strict";
                window.addEventListener("load", function() {
                    const mno = getUrlParam("mno");
                    if (mno != undefined) {
                        const childs = [].slice.call(document.getElementsByClassName("mno"));
                        childs.filter(e => e.value == mno).map(e => {
                            e.parentElement.classList.add("mno");
                        });
                    }
                }, false);
            }());

            function getUrlParam(name) {
                var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
                return (results && results[1]) || undefined;
            }

            $('.btn-search').click(function (e) {
                searchForm.submit();
            });

            $('.btn-clear').click(function (e) {
                window.location.href="/st"
            });


        </script>

    </th:block>

</th:block>
